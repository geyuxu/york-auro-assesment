# ========================================
# LLM 智能建图 - 完整命令（无障碍物版本）
# ========================================

# 终端 1 - 仿真环境（禁用障碍物/桶）
ros2 launch assessment assessment.launch.py \
  num_robots:=1 \
  use_nav2:=false \
  headless:=false \
  random_seed:=42 \
  barrels:=false\
  use_rviz:=true

# 终端 2 - Cartographer SLAM
ros2 launch assessment cartographer.launch.py \
  ns:=robot1 \
  use_sim_time:=true \
  use_rviz:=true

# 终端 3 - LLM 建图控制
cd /workspaces/AURO2025 && source install/setup.bash
ros2 run solution llm_mapper --ros-args --remap __ns:=/robot1

# ========================================
# 可选：手动控制机器人
# ========================================
ros2 run turtlebot3_teleop teleop_keyboard \
  --ros-args --remap cmd_vel:=/robot1/cmd_vel

# ========================================
# 终端 4 - 保存地图（建图完成后）
# ========================================

# 方法 1：保存为 PGM/YAML（用于导航）
cd /workspaces/AURO2025 && source install/setup.bash
ros2 run nav2_map_server map_saver_cli -f solution/config/clean_map \
  --ros-args -r map:=/robot1/map

# 方法 2：保存 Cartographer 状态（用于继续建图）
cd /workspaces/AURO2025 && source install/setup.bash
bash 保存Cartographer状态.sh robot1 clean_map


# ========================================
# 关键参数说明
# ========================================

# obstacles:=false   - 禁用所有桶和障碍物（建图阶段推荐）
# obstacles:=true    - 启用桶和障碍物（导航阶段使用）
# num_robots:=1      - 单机器人建图（Cartographer 默认配置）

# ========================================
# 为什么禁用障碍物？
# ========================================

# 1. 建图阶段不需要桶：
#    - 桶的位置是随机的（random_seed）
#    - 建图只需要环境的静态结构（墙壁、房间）
#    - 桶会干扰 SLAM，增加噪声

# 2. 导航阶段再启用桶：
#    - 使用已有的clean_map
#    - 启动时设置 obstacles:=true
#    - 机器人可以检测和收集桶

# ========================================
# 多机器人建图的问题
# ========================================

# Cartographer 默认不支持多机器人协同 SLAM：
# - 每个机器人有独立的命名空间
# - 无法实时合并多个机器人的地图
# - 需要使用 map merging 或其他工具后处理

# 如果需要多机器人建图，推荐方案：
# 1. 分别运行多个机器人建图
# 2. 使用 multirobot_map_merge 包合并地图
# 3. 或者使用单机器人完整建图（更简单）
