# 为什么推荐手动建图

## ⚠️ 重要发现

经过测试发现，**自动建图在当前环境中存在挑战**：

### 问题 1：起点位置特殊
- 机器人起点靠近房间入口
- 后方就是边界（房间外）
- 自动旋转时容易掉出地图

### 问题 2：门口导航困难
- 大门对激光雷达来说是"障碍物"
- 自动建图会尝试避开，导致转向
- 转向时可能向后旋转，掉出边界

### 问题 3：环境复杂度
- 评估环境有多个区域（收集区、去污区）
- 需要精确导航才能覆盖所有区域
- 自动建图的简单策略不够智能

---

## ✅ 强烈推荐：使用手动建图

### 手动建图的优势

#### 1. **完全可控**
- 你知道什么时候前进、后退、转弯
- 不会意外掉出地图
- 可以精确覆盖每个角落

#### 2. **更高质量**
- 可以慢速移动获得最佳 SLAM 效果
- 可以在重要区域多停留
- 可以手动完成闭环

#### 3. **适应性强**
- 遇到困难区域可以调整策略
- 可以先覆盖主要区域，再补充细节
- 不受固定算法限制

#### 4. **时间更短**
- 熟练后 3-5 分钟就能完成
- 不需要等待 8 分钟自动建图
- 出问题可以立即停止重来

---

## 🎯 推荐的手动建图策略

### 阶段 1：进入房间并沿墙探索（2分钟）

```
起点 → 向前进入大门 → 沿左墙顺时针 → 覆盖外圈 → 回到门口附近
```

**操作要点**：
- 缓慢前进通过大门
- 贴着墙壁移动，让激光雷达清楚扫描
- 顺时针绕一圈

### 阶段 2：覆盖中央区域（2分钟）

```
从外圈 → 向中心移动 → 覆盖中央空间 → 接近绿色收集区
```

**操作要点**：
- 以 S 形或 Z 形路径覆盖中央
- 确保激光雷达看到所有障碍物
- 接近但不要太靠近重要区域

### 阶段 3：精确覆盖关键区域（1分钟）

```
绿色收集区 → 蓝色去污区 → 其他重要区域
```

**操作要点**：
- 靠近但保持安全距离
- 确保区域边界清晰
- 完成闭环（回到起点附近）

---

## 📝 手动建图完整步骤

### 终端 1：启动仿真
```bash
cd /workspaces/AURO2025
source install/setup.bash
ros2 launch assessment assessment.launch.py \
  num_robots:=1 \
  use_nav2:=false \
  use_rviz:=false \
  headless:=false \
  random_seed:=42
```

### 终端 2：启动 Cartographer + RViz
```bash
cd /workspaces/AURO2025
source install/setup.bash
ros2 launch assessment cartographer.launch.py \
  ns:=robot1 \
  use_sim_time:=true \
  use_rviz:=true
```

### 终端 3：手动遥控
```bash
cd /workspaces/AURO2025
source install/setup.bash
ros2 run turtlebot3_teleop teleop_keyboard \
  --ros-args --remap cmd_vel:=/robot1/cmd_vel
```

**操作键位**：
- `w` = 前进（建议每次轻按一下）
- `a` = 左转
- `d` = 右转
- `x` = 后退（谨慎使用）
- `s` = 停止
- `空格` = 紧急停止

**建图技巧**：
1. **慢速移动** - 每次按 `w` 只按一下，不要连按
2. **平滑转弯** - 转弯时逐渐调整，避免急转
3. **保持距离** - 距离墙壁 0.3-0.5 米最佳
4. **观察 RViz** - 确保地图连续清晰
5. **完成闭环** - 最后回到起点附近

### 终端 4：保存地图（3-5分钟后）
```bash
cd /workspaces/AURO2025
source install/setup.bash
ros2 run nav2_map_server map_saver_cli -f solution/config/map2 \
  --ros-args -r map:=/robot1/map
```

---

## 🤖 如果还想尝试自动建图

### 改进版已经包含：
- ✅ 后方障碍物检测
- ✅ 只向一个方向旋转
- ✅ 更保守的速度
- ✅ 更大的安全距离

### 使用改进版自动建图：
```bash
# 终端 3（替代手动遥控）
cd /workspaces/AURO2025
source install/setup.bash
ros2 run solution auto_mapper --ros-args --remap __ns:=/robot1
```

**但请注意**：
- 仍然可能遇到复杂情况
- 需要在 Gazebo 中密切监控
- 如果机器人行为异常，立即 Ctrl+C 停止
- 准备好随时切换到手动模式

---

## 💡 混合策略（最佳实践）

**推荐的工作流程**：

1. **手动建图主要区域**（3-4分钟）
   - 完成基本地图框架
   - 覆盖外圈和重要区域
   - 形成闭环

2. **检查覆盖情况**
   - 在 RViz 中查看地图
   - 识别未覆盖区域
   - 规划补充路径

3. **手动补充细节**（1-2分钟）
   - 覆盖遗漏区域
   - 完善重要区域的细节
   - 最终检查

4. **保存地图**

这种方法结合了手动的精确性和效率，是最可靠的方案。

---

## 📊 对比总结

| 特性 | 手动建图 | 自动建图（改进版） |
|------|----------|-------------------|
| **可靠性** | ⭐⭐⭐⭐⭐ 非常可靠 | ⭐⭐⭐ 基本可靠 |
| **覆盖质量** | ⭐⭐⭐⭐⭐ 完全可控 | ⭐⭐⭐ 较好但不完美 |
| **时间** | ⭐⭐⭐⭐ 3-5分钟 | ⭐⭐ 8分钟 |
| **难度** | ⭐⭐⭐ 需要练习 | ⭐⭐⭐⭐⭐ 自动 |
| **风险** | ⭐⭐⭐⭐⭐ 低风险 | ⭐⭐⭐ 可能掉出地图 |
| **适应性** | ⭐⭐⭐⭐⭐ 高度灵活 | ⭐⭐ 固定策略 |

---

## 🎓 学习建议

如果是第一次手动建图：

1. **先练习遥控**
   - 在不启动 SLAM 的情况下练习控制
   - 熟悉键盘操作
   - 了解机器人速度

2. **小区域开始**
   - 不要一次覆盖整个环境
   - 先完成外圈
   - 再补充内部

3. **观察 RViz**
   - 边移动边观察地图
   - 看到空白区域就补充
   - 确保线条清晰

4. **多次尝试**
   - 第一次可能不完美
   - 重新建图很快（Ctrl+C 停止，重新开始）
   - 每次都会更熟练

---

## ✅ 结论

**对于 AURO2025 评估环境，强烈推荐使用手动建图。**

手动建图虽然需要一些操作技巧，但：
- 更可靠（不会掉出地图）
- 更快速（3-5分钟 vs 8分钟）
- 质量更高（完全可控）
- 更适合复杂环境

**如果你想要最好的地图质量和最快的速度，请使用手动建图！**

---

**相关文档**：
- [正确的建图步骤.md](正确的建图步骤.md) - 详细手动建图指南
- [建图命令.sh](建图命令.sh) - 命令速查
- [自动建图-改进版说明.md](自动建图-改进版说明.md) - 自动建图改进说明
